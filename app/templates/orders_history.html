{% extends "base.html" %}

{% block title %}Historia Zleceń{% endblock %}

{% block content %}
<h2><i class="fas fa-history"></i> Historia Zleceń</h2>

<form method="GET" class="form-inline mb-3">
    <select name="client" class="form-control mr-2">
        <option value="">Wszyscy klienci</option>
        {% for client in clients %}
            <option value="{{ client.name }}" {% if request.args.get('client','').upper() == client.name.upper() %}selected{% endif %}>{{ client.name }}</option>
        {% endfor %}
    </select>
    <select name="year" class="form-control mr-2">
        <option value="">Wszystkie lata</option>
        {% for y in years %}
            <option value="{{ y }}" {% if request.args.get('year') == y|string %}selected{% endif %}>{{ y }}</option>
        {% endfor %}
    </select>
    <select name="month" class="form-control mr-2">
        <option value="">Wszystkie miesiące</option>
        {% for m in range(1, 13) %}
            <option value="{{ m }}" {% if request.args.get('month') == m|string %}selected{% endif %}>{{ m }}</option>
        {% endfor %}
    </select>
    <button type="submit" class="btn btn-primary"><i class="fas fa-filter"></i> Filtruj</button>
</form>

<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead class="thead-light">
            <tr>
                <th>Nr zlecenia</th>
                <th>Klient</th>
                <th>Data utworzenia</th>
                <th>Status</th>
                <th>Akcje</th>
            </tr>
        </thead>
        <tbody>
            {% for order in orders %}
            <tr>
                <td>{{ order.order_code }}</td>
                <td>{{ order.client.name }}</td>
                <td>{{ order.created_at.strftime('%Y-%m-%d') }}</td>
                <td>{{ order.status }}</td>
                <td>
                    <a href="{{ url_for('order_detail', order_id=order.id) }}" class="btn btn-sm btn-info">Szczegóły</a>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="5" class="text-center">Brak zleceń do wyświetlenia.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% endblock %}